(()=>{"use strict";const e=(e,t,o)=>{let r=t,l=!1;return{name:e,length:t,piece:o,getHits:()=>r,getIsSunk:()=>l,hit:()=>{r-=1,r<=0&&(l=!0)}}},t=()=>{let t=(()=>{let t=!1,o=17;const r=()=>o,l=[["carrier",5,"C"],["battleship",4,"B"],["destroyer",3,"D"],["submarine",3,"S"],["patrol boat",2,"P"]];let a=[],c=[];const n=()=>{a=[];for(let e=0;e<10;e+=1){const e=[];for(let t=0;t<10;t+=1)e.push(null);a.push(e)}};n();const s=(e,t,o,r=!0)=>{const{length:l,piece:n}=o;if(r){if(l+t>=10)return!1;for(let o=t;o<l+t;o+=1)if(a[e][o]&&a[e][o])return!1;for(let o=t;o<l+t;o+=1)a[e][o]=n;a[e][t+l-1]=n}else{if(l+e>=10)return!1;for(let o=e;o<e+l;o+=1)if(a[o]&&a[o][t])return!1;for(let o=e;o<e+l;o+=1)a[o]&&(a[o][t]=n);a[e+l-1][t]=n}return c.push(o),!0},d=t=>{c=[];const o=()=>Math.floor(10*Math.random());for(let r=0;r<t.length;r+=1){const l=t[r],a=e(l[0],l[1],l[2]);let c=!1;for(;!c;){const e=Math.random()>.5,t=o(),r=o();c=s(t,r,a,e)}}};return d(l),{board:a,ships:c,receiveAttack:(e,l)=>{const n=a[l][e];if(n){const s=c.find((e=>e.piece===n));s&&(a[l][e]="X",s.hit(),o-=1,o<=0&&(t=!0,console.log(r()),console.log("all Sunk")))}else a[l][e]="O"},getTotalHits:r,getAllSunk:()=>t,reset:()=>{console.log("gameboard reset"),o=17,t=!1,c=[],a=[],n(),d(l)}}})(),o=!0;const r=new Set;return{attack:(e,t,o)=>(e.receiveAttack(t,o),e.board),computerAttack:e=>{let t,o;do{t=Math.floor(10*Math.random()),o=Math.floor(10*Math.random())}while(r.has(JSON.stringify([t,o])));return r.add(JSON.stringify([t,o])),e.receiveAttack(t,o),e.board},isTurn:()=>o,toggleTurn:()=>{o=!o},reset:()=>{console.log("player reset"),t.reset(),o=!0},gameboard:t}},o=()=>{const e=document.querySelectorAll(".gameboard");console.log(e),e.forEach((e=>{for(let t=0;t<10;t++)for(let o=0;o<10;o++){const r=document.createElement("div");r.classList.add("cell"),r.dataset.row=t,r.dataset.column=o,e.appendChild(r)}}))},r=(e,t)=>{console.log("populating board",e);const o=t?document.querySelectorAll(".player-board .cell"):document.querySelectorAll(".computer-board .cell");for(let t=0;t<10;t++)for(let r=0;r<10;r++)"X"===e[t][r]?o[10*t+r].classList.add("hit"):"O"===e[t][r]&&o[10*t+r].classList.add("miss");if(t)for(let t=0;t<10;t++)for(let r=0;r<10;r++)null!==e[t][r]?o[10*t+r].classList.add("occupied"):o[10*t+r].classList.remove("occupied")},l=t(),a=t(),c=document.getElementById("reset-btn");o(),c.addEventListener("click",(()=>{console.log("Index reset button"),l.reset(),a.reset(),l.toggleTurn(),document.querySelectorAll(".computer-board .cell").forEach((e=>{e.removeEventListener("click",s)})),r(l.gameboard.board,!0),r(a.gameboard.board,!1),d()}));const n=()=>{a.computerAttack(l.gameboard),a.toggleTurn(),d()},s=e=>{const t=parseInt(e.target.dataset.column,10),o=parseInt(e.target.dataset.row,10);l.attack(a.gameboard,t,o),l.toggleTurn(),setTimeout(n,0)},d=()=>{if(r(l.gameboard.board,!0),r(a.gameboard.board,!1),l.gameboard.getAllSunk()||a.gameboard.getAllSunk())return console.log("Game Over"),l.gameboard.reset(),a.gameboard.reset(),l.toggleTurn(),document.querySelectorAll(".computer-board .cell").forEach((e=>{e.removeEventListener("click",s)})),r(l.gameboard.board),r(a.gameboard.board),void d();l.isTurn()&&document.querySelectorAll(".computer-board .cell").forEach((e=>{e.addEventListener("click",s)}))};d()})();